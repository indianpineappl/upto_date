{"ast":null,"code":"var _PreferenceService;// Mock implementation for demonstration\n// In a real implementation, this would use localStorage or a backend database\nexport class PreferenceService{constructor(){this.storageKey='uptodate_preferences';}static getInstance(){if(!PreferenceService.instance){PreferenceService.instance=new PreferenceService();}return PreferenceService.instance;}/**\n   * Save user preferences to storage\n   */savePreferences(preferences){try{localStorage.setItem(this.storageKey,JSON.stringify(preferences));}catch(error){console.error('Failed to save preferences:',error);}}/**\n   * Load user preferences from storage\n   */loadPreferences(){try{const preferences=localStorage.getItem(this.storageKey);return preferences?JSON.parse(preferences):[];}catch(error){console.error('Failed to load preferences:',error);return[];}}/**\n   * Add a new preference\n   */addPreference(preference){const preferences=this.loadPreferences();// Remove existing preference for this topic\nconst filtered=preferences.filter(p=>p.topicId!==preference.topicId);// Add new preference\nconst updated=[...filtered,preference];this.savePreferences(updated);}/**\n   * Calculate topic score based on user preferences\n   */calculateTopicScore(topicId){const preferences=this.loadPreferences();const topicPreferences=preferences.filter(p=>p.topicId===topicId);if(topicPreferences.length===0){return 0;// Neutral score\n}// Calculate weighted average, giving more weight to recent preferences\nconst now=Date.now();let totalScore=0;let totalWeight=0;topicPreferences.forEach(pref=>{// Weight decreases as preference gets older (7 days half-life)\nconst ageInDays=(now-pref.timestamp)/(1000*60*60*24);const weight=Math.pow(0.5,ageInDays/7);totalScore+=pref.preferenceScore*weight;totalWeight+=weight;});return totalWeight>0?totalScore/totalWeight:0;}/**\n   * Get all topic scores\n   */getAllTopicScores(){const preferences=this.loadPreferences();const topicScores={};// Get unique topic IDs\nconst topicIds=Array.from(new Set(preferences.map(p=>p.topicId)));// Calculate score for each topic\ntopicIds.forEach(topicId=>{topicScores[topicId]=this.calculateTopicScore(topicId);});return topicScores;}/**\n   * Clear all preferences\n   */clearPreferences(){try{localStorage.removeItem(this.storageKey);}catch(error){console.error('Failed to clear preferences:',error);}}}_PreferenceService=PreferenceService;PreferenceService.instance=void 0;export default PreferenceService.getInstance();","map":{"version":3,"names":["PreferenceService","constructor","storageKey","getInstance","instance","savePreferences","preferences","localStorage","setItem","JSON","stringify","error","console","loadPreferences","getItem","parse","addPreference","preference","filtered","filter","p","topicId","updated","calculateTopicScore","topicPreferences","length","now","Date","totalScore","totalWeight","forEach","pref","ageInDays","timestamp","weight","Math","pow","preferenceScore","getAllTopicScores","topicScores","topicIds","Array","from","Set","map","clearPreferences","removeItem","_PreferenceService"],"sources":["/Users/ab/CascadeProjects/Upto date app/src/services/preferenceService.ts"],"sourcesContent":["// Mock implementation for demonstration\n// In a real implementation, this would use localStorage or a backend database\n\nimport { UserPreference } from '../types';\n\nexport class PreferenceService {\n  private static instance: PreferenceService;\n  private storageKey = 'uptodate_preferences';\n  \n  private constructor() {}\n  \n  public static getInstance(): PreferenceService {\n    if (!PreferenceService.instance) {\n      PreferenceService.instance = new PreferenceService();\n    }\n    return PreferenceService.instance;\n  }\n  \n  /**\n   * Save user preferences to storage\n   */\n  public savePreferences(preferences: UserPreference[]): void {\n    try {\n      localStorage.setItem(this.storageKey, JSON.stringify(preferences));\n    } catch (error) {\n      console.error('Failed to save preferences:', error);\n    }\n  }\n  \n  /**\n   * Load user preferences from storage\n   */\n  public loadPreferences(): UserPreference[] {\n    try {\n      const preferences = localStorage.getItem(this.storageKey);\n      return preferences ? JSON.parse(preferences) : [];\n    } catch (error) {\n      console.error('Failed to load preferences:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * Add a new preference\n   */\n  public addPreference(preference: UserPreference): void {\n    const preferences = this.loadPreferences();\n    // Remove existing preference for this topic\n    const filtered = preferences.filter(p => p.topicId !== preference.topicId);\n    // Add new preference\n    const updated = [...filtered, preference];\n    this.savePreferences(updated);\n  }\n  \n  /**\n   * Calculate topic score based on user preferences\n   */\n  public calculateTopicScore(topicId: string): number {\n    const preferences = this.loadPreferences();\n    const topicPreferences = preferences.filter(p => p.topicId === topicId);\n    \n    if (topicPreferences.length === 0) {\n      return 0; // Neutral score\n    }\n    \n    // Calculate weighted average, giving more weight to recent preferences\n    const now = Date.now();\n    let totalScore = 0;\n    let totalWeight = 0;\n    \n    topicPreferences.forEach(pref => {\n      // Weight decreases as preference gets older (7 days half-life)\n      const ageInDays = (now - pref.timestamp) / (1000 * 60 * 60 * 24);\n      const weight = Math.pow(0.5, ageInDays / 7);\n      \n      totalScore += pref.preferenceScore * weight;\n      totalWeight += weight;\n    });\n    \n    return totalWeight > 0 ? totalScore / totalWeight : 0;\n  }\n  \n  /**\n   * Get all topic scores\n   */\n  public getAllTopicScores(): Record<string, number> {\n    const preferences = this.loadPreferences();\n    const topicScores: Record<string, number> = {};\n    \n    // Get unique topic IDs\n    const topicIds = Array.from(new Set(preferences.map(p => p.topicId)));\n    \n    // Calculate score for each topic\n    topicIds.forEach(topicId => {\n      topicScores[topicId] = this.calculateTopicScore(topicId);\n    });\n    \n    return topicScores;\n  }\n  \n  /**\n   * Clear all preferences\n   */\n  public clearPreferences(): void {\n    try {\n      localStorage.removeItem(this.storageKey);\n    } catch (error) {\n      console.error('Failed to clear preferences:', error);\n    }\n  }\n}\n\nexport default PreferenceService.getInstance();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}